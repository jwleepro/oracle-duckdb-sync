# UI ì•„í‚¤í…ì²˜ ë¬¸ì„œ

## ê°œìš”

Oracle-DuckDB Sync í”„ë¡œì íŠ¸ì˜ UIëŠ” **ì—­í•  ê¸°ë°˜ ì ‘ê·¼ ì œì–´(RBAC)**ì™€ **ë¼ìš°í„° íŒ¨í„´**ì„ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ìì™€ ê´€ë¦¬ì ë©”ë‰´ë¥¼ ë¶„ë¦¬í•œ êµ¬ì¡°ë¡œ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

## ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Streamlit App                           â”‚
â”‚                     (main.py)                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â”œâ”€â”€â”€ Authentication Check (require_auth)
                        â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                               â”‚
        â–¼                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Navigation   â”‚              â”‚    Router     â”‚
â”‚  (sidebar)    â”‚              â”‚  (dynamic     â”‚
â”‚               â”‚              â”‚   loading)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                               â”‚
        â”‚                               â”‚
        â”œâ”€â”€â”€ User Role Filter           â”œâ”€â”€â”€ Permission Check
        â”‚                               â”‚
        â–¼                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User Menus   â”‚              â”‚ Page Modules  â”‚
â”‚   - Dashboard â”‚              â”‚               â”‚
â”‚   - Data View â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚   - Visualization
â”‚   - AI Agent  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Admin Menus  â”‚
â”‚   - Sync      â”‚
â”‚   - Users     â”‚
â”‚   - Menus     â”‚
â”‚   - Tables    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ì£¼ìš” ì»´í¬ë„ŒíŠ¸

### 1. ë©”ì¸ ì§„ì…ì  (main.py)

ìƒˆë¡œìš´ Streamlit ì•±ì˜ ì§„ì…ì ì…ë‹ˆë‹¤.

**ì±…ì„:**
- í˜ì´ì§€ ì„¤ì • (`set_page_config`)
- ì„¸ì…˜ ìƒíƒœ ì´ˆê¸°í™”
- ì¸ì¦ í™•ì¸
- ë„¤ë¹„ê²Œì´ì…˜ ë Œë”ë§
- ë¼ìš°í„°ë¥¼ í†µí•œ í˜ì´ì§€ ë Œë”ë§

**ì½”ë“œ ì˜ˆì‹œ:**
```python
def main():
    st.set_page_config(...)
    initialize_session_state()

    if not authenticated:
        render_login_page()
        return

    render_sidebar_navigation(user)
    router = get_router()
    router.navigate(current_page, user)
```

### 2. ë¼ìš°í„° (router.py)

ë™ì  í˜ì´ì§€ ë¡œë”©ê³¼ ê¶Œí•œ ê²€ì¦ì„ ë‹´ë‹¹í•©ë‹ˆë‹¤.

**ê¸°ëŠ¥:**
- ê²½ë¡œ(`path`) â†’ ëª¨ë“ˆ ë§¤í•‘
- ë™ì  ëª¨ë“ˆ ë¡œë”© (`importlib`)
- ê¶Œí•œ ê¸°ë°˜ ì ‘ê·¼ ì œì–´
- ì˜ëª»ëœ ê²½ë¡œ ì²˜ë¦¬

**ë¼ìš°íŠ¸ êµ¬ì¡°:**
```python
self.routes = {
    '/dashboard': ('oracle_duckdb_sync.ui.pages.user.dashboard', 'render_dashboard', None),
    '/admin/sync': ('oracle_duckdb_sync.ui.pages.admin.sync', 'render_sync_page', 'admin:*'),
    ...
}
```

**ì£¼ìš” ë©”ì„œë“œ:**
- `register(path, module_path, function_name, permission)`: ìƒˆ ë¼ìš°íŠ¸ ë“±ë¡
- `navigate(path, user)`: ê²½ë¡œë¡œ ì´ë™ (ê¶Œí•œ ê²€ì¦ í¬í•¨)

### 3. ë„¤ë¹„ê²Œì´ì…˜ (navigation.py)

ì—­í•  ê¸°ë°˜ ì‚¬ì´ë“œë°” ë©”ë‰´ë¥¼ ë Œë”ë§í•©ë‹ˆë‹¤.

**ê¸°ëŠ¥:**
- ì‚¬ìš©ì ì—­í• ì— ë”°ë¥¸ ë©”ë‰´ í•„í„°ë§
- ë©”ë‰´ í™•ì¥/ì¶•ì†Œ ìƒíƒœ ê´€ë¦¬
- í˜„ì¬ í˜ì´ì§€ í•˜ì´ë¼ì´íŠ¸
- ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼

**ë©”ë‰´ êµ¬ì¡°:**

**ì‚¬ìš©ì ë©”ë‰´** (ëª¨ë“  ì—­í• ):
- ğŸ  ëŒ€ì‹œë³´ë“œ
- ğŸ“Š ë°ì´í„° ì¡°íšŒ
- ğŸ“ˆ ì‹œê°í™”
- ğŸ¤– AI ì—ì´ì „íŠ¸

**ê´€ë¦¬ì ë©”ë‰´** (ADMINë§Œ):
- ğŸ”„ ë™ê¸°í™” ê´€ë¦¬
- ğŸ‘¥ ì‚¬ìš©ì ê´€ë¦¬
- ğŸ“‘ ë©”ë‰´ ê´€ë¦¬
- ğŸ—„ï¸ í…Œì´ë¸” ì„¤ì •

### 4. ì„¸ì…˜ ìƒíƒœ (session_state.py)

Streamlit ì„¸ì…˜ ìƒíƒœë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤.

**ë„¤ë¹„ê²Œì´ì…˜ ê´€ë ¨ ìƒíƒœ:**
```python
{
    'current_page': '/dashboard',  # í˜„ì¬ í˜ì´ì§€ ê²½ë¡œ
    'menu_expanded': {
        'user': True,   # ì‚¬ìš©ì ë©”ë‰´ í™•ì¥ ìƒíƒœ
        'admin': False  # ê´€ë¦¬ì ë©”ë‰´ í™•ì¥ ìƒíƒœ
    }
}
```

### 5. í˜ì´ì§€ ëª¨ë“ˆ

#### ì‚¬ìš©ì í˜ì´ì§€ (`pages/user/`)

- **dashboard.py**: ì‹œìŠ¤í…œ ìƒíƒœ ìš”ì•½ ë° ë¹ ë¥¸ ì•¡ì…˜
- **data_view.py**: í…Œì´ë¸” ë°ì´í„° ì¡°íšŒ (ì§‘ê³„/ìƒì„¸)
- **visualization.py**: ë°ì´í„° ì‹œê°í™”
- **agent_chat.py**: AI ì—ì´ì „íŠ¸ ì±„íŒ… ì¸í„°í˜ì´ìŠ¤

#### ê´€ë¦¬ì í˜ì´ì§€ (`pages/admin/`)

- **sync.py**: ë™ê¸°í™” ì„¤ì • ë° ì‹¤í–‰
- **users.py**: ì‚¬ìš©ì ê³„ì • ê´€ë¦¬
- **menus.py**: ë©”ë‰´ êµ¬ì¡° ê´€ë¦¬
- **tables.py**: ë™ê¸°í™” í…Œì´ë¸” ì„¤ì •

## ê¶Œí•œ ì‹œìŠ¤í…œ

### ì—­í•  (UserRole)

```python
class UserRole(str, Enum):
    ADMIN = "admin"     # ëª¨ë“  ê¶Œí•œ
    USER = "user"       # ì¡°íšŒ ë° ì‹¤í–‰
    VIEWER = "viewer"   # ì½ê¸° ì „ìš©
```

### ê¶Œí•œ ì²´í¬ ë°ì½”ë ˆì´í„°

```python
@require_auth(required_permission="admin:*")
def render_admin_page():
    ...
```

### ê¶Œí•œ ë§¤íŠ¸ë¦­ìŠ¤

| ì—­í•     | ì½ê¸° | ì“°ê¸° | ë™ê¸°í™” | ì‚¬ìš©ì ê´€ë¦¬ | ì„¤ì • ë³€ê²½ |
|---------|------|------|--------|-------------|-----------|
| ADMIN   | âœ…   | âœ…   | âœ…     | âœ…          | âœ…        |
| USER    | âœ…   | âœ…   | âœ…     | âŒ          | âŒ        |
| VIEWER  | âœ…   | âŒ   | âŒ     | âŒ          | âŒ        |

## ë””ë ‰í† ë¦¬ êµ¬ì¡°

```
src/oracle_duckdb_sync/ui/
â”œâ”€â”€ main.py                    # ìƒˆ ì§„ì…ì 
â”œâ”€â”€ router.py                  # ë¼ìš°í„° ì‹œìŠ¤í…œ
â”œâ”€â”€ navigation.py              # ë„¤ë¹„ê²Œì´ì…˜ ì»´í¬ë„ŒíŠ¸
â”œâ”€â”€ session_state.py           # ì„¸ì…˜ ìƒíƒœ ê´€ë¦¬
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ login.py              # ë¡œê·¸ì¸ í˜ì´ì§€
â”‚   â”œâ”€â”€ user/                 # ì‚¬ìš©ì í˜ì´ì§€
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ dashboard.py
â”‚   â”‚   â”œâ”€â”€ data_view.py
â”‚   â”‚   â”œâ”€â”€ visualization.py
â”‚   â”‚   â””â”€â”€ agent_chat.py
â”‚   â””â”€â”€ admin/                # ê´€ë¦¬ì í˜ì´ì§€
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ sync.py
â”‚       â”œâ”€â”€ users.py
â”‚       â”œâ”€â”€ menus.py
â”‚       â””â”€â”€ tables.py
â””â”€â”€ components/               # ì¬ì‚¬ìš© ê°€ëŠ¥í•œ UI ì»´í¬ë„ŒíŠ¸
```

## í˜ì´ì§€ ì¶”ê°€ ë°©ë²•

### 1. í˜ì´ì§€ ëª¨ë“ˆ ìƒì„±

```python
# src/oracle_duckdb_sync/ui/pages/user/my_page.py
from oracle_duckdb_sync.ui.pages.login import require_auth

@require_auth(required_permission="sync:read")
def render_my_page():
    st.title("ë‚´ í˜ì´ì§€")
    ...
```

### 2. ë¼ìš°í„°ì— ë“±ë¡

```python
# src/oracle_duckdb_sync/ui/router.py
def _register_default_routes(self):
    # ... ê¸°ì¡´ ë¼ìš°íŠ¸ ...

    # ìƒˆ í˜ì´ì§€ ì¶”ê°€
    self.register(
        '/my-page',
        'oracle_duckdb_sync.ui.pages.user.my_page',
        'render_my_page',
        'sync:read'  # í•„ìš”í•œ ê¶Œí•œ
    )
```

### 3. ë„¤ë¹„ê²Œì´ì…˜ì— ì¶”ê°€

```python
# src/oracle_duckdb_sync/ui/navigation.py
def _render_user_menus(self):
    # ... ê¸°ì¡´ ë©”ë‰´ ...

    # ìƒˆ ë©”ë‰´ ì¶”ê°€
    if st.sidebar.button("ğŸ†• ë‚´ í˜ì´ì§€", use_container_width=True):
        st.session_state.current_page = '/my-page'
        st.rerun()
```

## ì‹¤í–‰ ë°©ë²•

### Streamlit ì§ì ‘ ì‹¤í–‰

```bash
streamlit run src/oracle_duckdb_sync/ui/main.py
```

### Python ëª¨ë“ˆë¡œ ì‹¤í–‰

```bash
python -m streamlit run src/oracle_duckdb_sync/ui/main.py
```

### ê°œë°œ ëª¨ë“œ (ìë™ ì¬ì‹œì‘)

```bash
streamlit run src/oracle_duckdb_sync/ui/main.py --server.runOnSave=true
```

## í…ŒìŠ¤íŠ¸

UI ë¼ìš°íŒ… ë° ê¶Œí•œ í…ŒìŠ¤íŠ¸:

```bash
python tests/test_ui_routing.py
```

**í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€:**
- âœ… ë¼ìš°í„° ì´ˆê¸°í™”
- âœ… ê¸°ë³¸ ë¼ìš°íŠ¸ ë“±ë¡
- âœ… ê¶Œí•œ ì‹œìŠ¤í…œ
- âœ… ì—­í• ë³„ ê¶Œí•œ
- âœ… ì„¸ì…˜ ìƒíƒœ

## ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

1. **ì¸ì¦ í•„ìˆ˜**: ëª¨ë“  í˜ì´ì§€ëŠ” `@require_auth` ë°ì½”ë ˆì´í„° ì‚¬ìš©
2. **ê¶Œí•œ ê²€ì¦**: ë¼ìš°í„°ê°€ í˜ì´ì§€ ë¡œë“œ ì „ ê¶Œí•œ í™•ì¸
3. **ì„¸ì…˜ ê´€ë¦¬**: Streamlit ì„¸ì…˜ ìƒíƒœë¡œ ì¸ì¦ ì •ë³´ ê´€ë¦¬
4. **ë¹„ë°€ë²ˆí˜¸ í•´ì‹±**: bcryptë¥¼ ì‚¬ìš©í•œ ì•ˆì „í•œ ë¹„ë°€ë²ˆí˜¸ ì €ì¥

## ì„±ëŠ¥ ìµœì í™”

1. **ë™ì  ë¡œë”©**: í•„ìš”í•œ í˜ì´ì§€ë§Œ ë¡œë“œ (importlib ì‚¬ìš©)
2. **ìºì‹±**: ë°ì´í„° ì¡°íšŒ ê²°ê³¼ ìºì‹±
3. **ì„¸ì…˜ ìƒíƒœ**: í˜ì´ì§€ ê°„ ë°ì´í„° ê³µìœ ë¡œ ì¤‘ë³µ ì¡°íšŒ ë°©ì§€

## í™•ì¥ì„±

ìƒˆë¡œìš´ ê¸°ëŠ¥ ì¶”ê°€ê°€ ìš©ì´í•œ êµ¬ì¡°:
- í˜ì´ì§€ ëª¨ë“ˆ ì¶”ê°€: íŒŒì¼ ìƒì„± + ë¼ìš°íŠ¸ ë“±ë¡
- ë©”ë‰´ ì¶”ê°€: ë„¤ë¹„ê²Œì´ì…˜ í•¨ìˆ˜ ìˆ˜ì •
- ê¶Œí•œ ì¶”ê°€: ê¶Œí•œ ì‹œìŠ¤í…œ í™•ì¥
- ì»´í¬ë„ŒíŠ¸ ì¬ì‚¬ìš©: components/ ë””ë ‰í† ë¦¬ í™œìš©

## ë§ˆì´ê·¸ë ˆì´ì…˜ ê°€ì´ë“œ

### ê¸°ì¡´ ì•±ì—ì„œ ìƒˆ êµ¬ì¡°ë¡œ

1. **ë°±ì—…**: ê¸°ì¡´ ì½”ë“œ ë°±ì—…
2. **ì„¸ì…˜ ìƒíƒœ**: `initialize_session_state()` í˜¸ì¶œ
3. **ë¼ìš°íŠ¸ ë“±ë¡**: ê¸°ì¡´ í˜ì´ì§€ë¥¼ ë¼ìš°í„°ì— ë“±ë¡
4. **ê¶Œí•œ ì¶”ê°€**: í•„ìš”í•œ í˜ì´ì§€ì— `@require_auth` ì¶”ê°€
5. **í…ŒìŠ¤íŠ¸**: ëª¨ë“  í˜ì´ì§€ ì ‘ê·¼ í…ŒìŠ¤íŠ¸

## ë¬¸ì œ í•´ê²°

### í˜ì´ì§€ê°€ ë¡œë“œë˜ì§€ ì•ŠìŒ

1. ë¼ìš°íŠ¸ê°€ ë“±ë¡ë˜ì—ˆëŠ”ì§€ í™•ì¸
2. ëª¨ë“ˆ ê²½ë¡œê°€ ì˜¬ë°”ë¥¸ì§€ í™•ì¸
3. í•¨ìˆ˜ ì´ë¦„ì´ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸
4. ê¶Œí•œì´ ì˜¬ë°”ë¥¸ì§€ í™•ì¸

### ê¶Œí•œ ì˜¤ë¥˜

1. ì‚¬ìš©ì ì—­í•  í™•ì¸
2. í•„ìš”í•œ ê¶Œí•œ í™•ì¸
3. ê¶Œí•œ ì²´í¬ ë¡œì§ ê²€ì¦

### ì„¸ì…˜ ìƒíƒœ ì˜¤ë¥˜

1. `initialize_session_state()` í˜¸ì¶œ í™•ì¸
2. ì„¸ì…˜ í‚¤ ì´ë¦„ í™•ì¸
3. Streamlit ì¬ì‹œì‘

## ì°¸ê³  ìë£Œ

- [Streamlit ê³µì‹ ë¬¸ì„œ](https://docs.streamlit.io/)
- [Python importlib](https://docs.python.org/3/library/importlib.html)
- [RBAC íŒ¨í„´](https://en.wikipedia.org/wiki/Role-based_access_control)

## ë³€ê²½ ì´ë ¥

| ë‚ ì§œ       | ë²„ì „ | ë³€ê²½ ë‚´ìš©                          |
|-----------|------|------------------------------------|
| 2026-01-27| 1.0  | ì´ˆê¸° ë¼ìš°í„° ë° ë„¤ë¹„ê²Œì´ì…˜ ì‹œìŠ¤í…œ êµ¬ì¶• |
| 2026-01-27| 1.1  | ì‚¬ìš©ì/ê´€ë¦¬ì ë©”ë‰´ ë¶„ë¦¬ ì™„ë£Œ       |
