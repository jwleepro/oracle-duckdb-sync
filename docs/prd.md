# PRD: Oracle-to-DuckDB 데이터 동기화/분석 대시보드

## 1. 개요

### 1.1 배경
- Oracle 11g 단일 DB에서 기간별 대용량 집계 쿼리를 수행하면서 부하와 응답 지연이 발생
- 여러 애플리케이션이 동일 DB에 의존해 트래픽이 집중되고 장애 리스크가 존재
- 분석·시각화 경험과 도구 부족으로 운영 데이터 활용이 제한적

### 1.2 목표
- DuckDB 기반의 분석 전용 레이어를 구축해 조회 성능을 기존 대비 10배 이상 개선
- 매일 자동 동기화를 통해 Oracle과 분석 DB 간 데이터 일관성을 보장
- 기간별 데이터 조회, 테이블 뷰, 차트 시각화를 제공해 의사결정 지원

### 1.3 시스템 아키텍처
- **DuckDB 임베디드 방식**: 별도 DB 서버 없이 Streamlit 앱 프로세스 내에서 직접 실행
- **파일 기반 저장소**: `./data/sync.duckdb` 파일로 데이터 영속화
- **단일 Writer, 다중 Reader**: 동기화는 배치 프로세스가, 조회는 Streamlit이 담당
```
┌───────────────────────────┐
│       사용자 브라우저      │
└───────────────┬───────────┘
                │ HTTP/HTTPS
                ▼
┌───────────────────────────┐
│       Streamlit 앱        │
│  (UI + Python 서비스)     │
└───────────────┬───────────┘
                │
        ┌───────┴────────┬──────────┐
        ▼                ▼          ▼
┌────────────┐   ┌────────────┐   ┌─────────────┐
│ Oracle 11g │   │ 배치/동기화 │   │ DuckDB  │
└────────────┘   └────────────┘   └─────────────┘
```

### 1.4 구성 요소
| 구성 요소 | 역할 |
|-----------|------|
| Oracle 11g | 운영 데이터 소스, 변경 불가 SSOT |
| DuckDB | 파일 기반 분석용 DB, 임베디드 실행으로 고속 조회 담당 (별도 서버 불필요) |
| 동기화 배치 | 초기 이관 및 증분 동기화 실행, 로그/재시도 처리 |
| Streamlit 앱 | 데이터 조회·차트·모니터링 UI 제공 |

---

## 2. 데이터 범위

### 2.1 데이터 모델
| 구분 | 설명 |
|------|------|
| 원천 데이터 | Oracle 11g 지정 테이블(운영 데이터) |
| 분석 데이터 | DuckDB로 이관된 동일 스키마의 조회/분석용 데이터 |

### 2.2 데이터 규모(가정)
- 초기 이관: 수백만 건 이상 테이블 병렬 처리
- 일일 증분: 전일 TRAN_TIME 기준 적재, 실패 시 재시도 3회 이상

---

## 3. 기능 요구사항

### 3.1 Phase 01: 동기화
| ID | 요구사항 | 우선순위 |
|----|----------|----------|
| FR-001 | Oracle→DuckDB 초기 풀 동기화(병렬 처리, 진행 모니터링) | P0 |
| FR-002 | 매일 새벽 전일 데이터 증분 동기화(스케줄러, 재시도 3회) | P0 |
| FR-003 | 동기화 로그·성공/실패 현황 및 인덱스별 통계 제공 | P1 |
| FR-003-1 | 실시간 동기화 진행 상황 모니터링(프로그레스 바, 처리 속도, 경과 시간) | P0 |
| FR-003-2 | 동기화 제어 기능(일시정지, 재개, 취소) | P0 |
| FR-003-3 | 실시간 로그 스트리밍 및 오류 즉시 표시 | P0 |

### 3.2 Phase 02: 조회·테이블 뷰
| ID | 요구사항 | 우선순위 |
|----|----------|----------|
| FR-004 | 기간/조건 필터 기반 데이터 조회(Date Picker, 사전 설정 기간) | P0 |
| FR-005 | 테이블 뷰 정렬·필터·컬럼 토글 및 CSV/Excel 다운로드 | P1 |

### 3.3 Phase 03: 차트/분석
| ID | 요구사항 | 우선순위 |
|----|----------|----------|
| FR-006 | 라인/바/에어리어/파이·도넛/산점도/히스토그램/박스플롯 지원 | P1 |
| FR-007 | 기준선(상·하한, 평균, 중앙값, ±σ 밴드, 목표선, 추세선) 표시 | P2 |

### 3.4 Phase 04: 계정 관리
| ID | 요구사항 | 우선순위 |
|----|----------|----------|
| FR-008 | 계정 등록,변경,삭제 관리 | P1 |
| FR-009 | 권한 관리(관리자, 일반 사용자) | P1 |
| FR-010 | 메뉴 등록,변경,삭제 관리 | P1 |
| FR-011 | 권한별 메뉴 관리 | P1 |

---

## 4. 비기능 요구사항

### 4.1 성능
| 지표 | 목표 |
|------|------|
| 차트 렌더링 | 10만 행 기준 1초 이내 |
| 동시 사용자 | 최소 10명 동시 응답 |
| 증분 동기화 | 1만 건 기준 1분 이내 |
| 진행 상황 업데이트 | 1초 이내 UI 반영 |
| 진행 콜백 오버헤드 | 전체 동기화 시간의 1% 미만 |

### 4.2 가용성·신뢰성
| 지표 | 목표 |
|------|------|
| 서비스 가용성 | 99.5% 이상 |
| 동기화 성공률 | 99.9% 이상 |
| 재시도/복구 | 네트워크 오류 시 자동 재시도 및 로그 기록 |
| 파일 무결성 | WAL(Write-Ahead Log) 기반 트랜잭션 보장 |
| 동시성 제어 | 단일 Writer 제약, 배치 실행 중 조회 차단 방지 |
| UI 응답성 | 동기화 중에도 UI 블로킹 없이 실시간 상태 확인 가능 |
| 오류 가시성 | 오류 발생 즉시 UI 표시 및 로그 파일 기록 |

### 4.3 확장성·운영
| 지표 | 목표 |
|------|------|
| 스키마 확장 | 신규 테이블/컬럼 추가 시 설정만으로 반영 |
| 인프라 확장 | 대용량 처리 대비 수평 확장 구조 |

---

## 5. 기술 스택

| 영역 | 기술 | 비고 |
|------|------|------|
| 운영 DB | Oracle 11g | 변경 불가, SSOT |
| 분석 DB | DuckDB | 고속 집계/조회 |
| 언어/런타임 | Python 3.9+ | 배치·ETL·애플리케이션 |
| 백엔드/UI | Streamlit | 단일 코드베이스로 UI+로직 |
| 스케줄러 | APScheduler | 일일 증분 배치 |
| 차트 | Plotly | 인터랙티브 차트/기준선 |

---

## 6. 제약 및 가정

- INSERT-only: 원천 Oracle 데이터는 수정/삭제 없이 적재 전용
- Oracle 버전 고정(11g) 및 네트워크 허용 필요
- 대상 테이블에 기간/시간 컬럼이 존재하고 구조화돼 있다고 가정
- 대상 테이블에 기간/시간 컬럼이 존재하지 않으면 문자열 컬럼에 기간/시간 정보가 저장되어 있다고 가정
- DuckDB 파일 저장 경로(`./data/`)에 대한 읽기/쓰기 권한 필요
- 파일 시스템 용량: 최소 Oracle 테이블 크기의 1.5배 이상 확보
- Windows 환경에서 WSL 불필요 (ClickHouse 대비 장점)

---